<?php 
	$uploadFolder = '/var/www/html/emmc_0.1/statusFiles/uploadFiles/';
	//$writeJSONdir = './statusFiles';
	$statusFolder =  '/var/www/html/emmc_0.1/statusFiles/';
	//$writeJSONdir = '/home/vli/eclipseWorkspace/eMMCTester/';
	$JSONfile = 'CMD.json';
	$executionFile = 'eMMCTester';
	$exec = $statusFolder.$executionFile." ".$statusFolder." ".$JSONfile;
	
	$data = array();
	if(isset($_GET['files'])) {	
		$error = false;
		$files = array();

		foreach($_FILES as $file) {
			if(move_uploaded_file($file['tmp_name'], $uploadFolder .basename($file['name']))) {
				$files[] = $uploadFolder .$file['name'];
			} else {
				$error = true;
			}
		}

		$data = ($error) ? array('error' => $file['name'] . 'There was an error uploading your files') : array('files' => $files);
	} else {
		$cmdFIFO = $_POST['postCmdFIFO'];

		if (json_decode($cmdFIFO) != null) {
		   $file = fopen($statusFolder . $JSONfile, 'w');
		   fwrite($file, $cmdFIFO);
		   fclose($file);
		}

		$data = array('success' => "Waiting for response...", 'formData' => $_POST['postFormData']);
		exec ($exec);
		//exec ("/var/www/html/emmc_0.1/statusFiles/eMMCTester /var/www/html/emmc_0.1/statusFiles/ CMD.json");
		//exec("$statusFolder.$executionFile $statusFolder $JSONfile");
	}
	
	echo json_encode($data);
?>

